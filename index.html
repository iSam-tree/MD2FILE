<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="theme-color" content="#f2f2f7" media="(prefers-color-scheme: light)" class="dynamic-meta">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)" class="dynamic-meta">
    
    <title>MD2File</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            /* iOS 26 ç³»ç»Ÿ UI æŒ‡ä»¤ */
            color-scheme: light;
            
            --bg: #f2f2f7;
            --sidebar-bg: rgba(255, 255, 255, 0.75);
            --pane-bg: rgba(255, 255, 255, 0.45);
            --text: #1d1d1f;
            --border: rgba(0, 0, 0, 0.1);
            --head-edit-bg: #ffffff; --head-edit-text: #000000;
            --head-view-bg: #000000; --head-view-text: #ffffff;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
        }

        [data-theme="dark"] {
            color-scheme: dark;
            --bg: #000000;
            --sidebar-bg: rgba(28, 28, 30, 0.85);
            --pane-bg: rgba(44, 44, 46, 0.45);
            --text: #f5f5f7;
            --border: rgba(255, 255, 255, 0.12);
            --head-edit-bg: #1c1c1e; --head-edit-text: #ffffff;
            --head-view-bg: #ffffff; --head-view-text: #000000;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.35);
        }

        /* æ ¸å¿ƒä¿®å¤ï¼šç‰©ç†é”æ­»ç”»å¸ƒé¢œè‰² */
        html, :root {
            background-color: var(--bg) !important;
            /* å…³é”®ï¼šé˜»æ­¢èƒŒæ™¯éšæ»‘åŠ¨åç§»å¯¼è‡´çš„é‡‡æ ·å¤±è´¥ */
            background-attachment: fixed; 
            height: 100%;
            width: 100%;
            transition: background-color 0.3s;
        }

        body { 
            margin: 0; font-family: -apple-system, system-ui, sans-serif; 
            color: var(--text); background-color: var(--bg) !important;
            height: 100dvh; width: 100%; overflow: hidden; 
            transition: background-color 0.3s;
            /* é˜»æ­¢ iOS æ©¡çš®ç­‹å›å¼¹éœ²å‡ºåº•å±‚ç™½è‰² */
            overscroll-behavior: none; 
        }

        .app-container { display: flex; height: 100dvh; width: 100vw; align-items: stretch; overflow: hidden; }

        .sidebar {
            width: 280px; background: var(--sidebar-bg); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px);
            border-right: 1px solid var(--border); padding: 32px 24px; display: flex; flex-direction: column; gap: 24px; flex-shrink: 0;
            overflow-y: auto;
        }
        .header-row { display: flex; justify-content: space-between; align-items: center; }
        .brand { font-size: 1.6rem; font-weight: 700; letter-spacing: -1px; }
        .top-tools { display: flex; gap: 12px; }
        .icon-btn { 
            background: var(--pane-bg); border: 1px solid var(--border); border-radius: 50%; 
            width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: var(--text); font-weight: 600; font-size: 12px;
        }

        .control-item { display: flex; flex-direction: column; gap: 8px; }
        label { font-size: 11px; font-weight: 600; color: #86868b; text-transform: uppercase; }
        select, input { padding: 12px; border: 1px solid var(--border); border-radius: 12px; background: var(--pane-bg); color: var(--text); outline: none; }
        .btn { padding: 14px; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 14px; }
        .btn-pdf { background: var(--text); color: var(--bg); }
        .btn-img { background: transparent; border: 1.5px solid var(--text); color: var(--text); }

        .content-area { flex: 1; display: flex; padding: 24px; gap: 24px; align-items: stretch; overflow: hidden; height: 100%; }
        
        /* ç‰©ç†éš”ç¦»æ¶æ„ */
        .pane {
            flex: 1; min-width: 0; display: flex; flex-direction: column; 
            background: var(--pane-bg); border-radius: 24px; border: 1px solid var(--border);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            box-shadow: var(--shadow); overflow: hidden;
        }

        .pane-head {
            height: 48px; flex-shrink: 0; padding: 0 24px; font-size: 11px; font-weight: 700;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--border); z-index: 50;
        }
        .head-edit { background: var(--head-edit-bg); color: var(--head-edit-text); }
        .head-view { background: var(--head-view-bg); color: var(--head-view-text); }
        .clear-btn { background: none; border: none; color: inherit; opacity: 0.6; cursor: pointer; font-size: 11px; font-weight: 600; }

        .pane-body { flex: 1; display: flex; flex-direction: column; overflow: hidden; height: 100%; min-width: 0; position: relative; }
        textarea, #preview-scroll { flex: 1; width: 100%; height: 100%; padding: 32px; background: transparent; overflow-y: auto; overflow-x: hidden; }
        textarea { border: none; resize: none; outline: none; font-family: "SF Mono", monospace; font-size: 14px; line-height: 1.6; color: var(--text); }
        
        #preview-inner { line-height: 1.8; overflow-wrap: anywhere; word-wrap: break-word; word-break: break-all; width: 100%; max-width: 100%; padding-bottom: 100px; }
        .export-mode { font-size: 18px !important; line-height: 2.0 !important; padding: 40px 48px !important; }

        #preview-inner img, #preview-inner table { max-width: 100% !important; height: auto !important; }
        #preview-inner table { table-layout: fixed; border-collapse: collapse; width: 100%; }
        #preview-inner td, #preview-inner th { border: 1px solid var(--border); padding: 8px; }
        #preview-inner pre { white-space: pre-wrap !important; word-break: break-all !important; background: rgba(0,0,0,0.05); padding: 15px; border-radius: 12px; }

        @media (max-width: 850px) {
            body { overflow-y: auto; height: auto; }
            .app-container { flex-direction: column; height: auto; overflow: visible; }
            .sidebar { width: 100%; position: sticky; top: 0; z-index: 100; border-right: none; padding: 20px; height: auto; border-bottom: 1px solid var(--border); }
            .content-area { flex-direction: column; height: auto; padding: 16px; gap: 16px; overflow: visible; }
            .pane { height: auto; min-height: 520px; flex: none; overflow: visible; border-radius: 20px; margin-bottom: 20px; }
            .pane-head { position: sticky; top: 78px; z-index: 90; border-radius: 24px 24px 0 0; } 
            .pane-body { overflow: visible; height: auto; }
            textarea, #preview-scroll { padding: 24px; font-size: 16px; overflow: visible; height: auto; }
        }

        .clone-hidden { position: absolute; left: -9999px; top: 0; height: auto !important; width: auto; z-index: -1; }
    </style>
</head>
<body>

<div class="app-container">
    <aside class="sidebar">
        <div class="header-row">
            <div class="brand">MD2File</div>
            <div class="top-tools">
                <button class="icon-btn" onclick="toggleLang()" id="lang-btn">EN</button>
                <button class="icon-btn" onclick="toggleTheme()" id="theme-btn">â˜€ï¸</button>
            </div>
        </div>
        <div class="control-item">
            <label id="label-pdf">PDF å¯¼å‡ºå°ºå¯¸</label>
            <select id="pdf-size" onchange="checkCustom()"></select>
            <div id="custom-pdf" style="display:none; gap:5px; margin-top:5px;">
                <input type="number" id="pw" value="210">
                <input type="number" id="ph" value="297">
            </div>
            <button class="btn btn-pdf" onclick="exportPDF()" id="btn-pdf">å¯¼å‡º PDF</button>
        </div>
        <div class="control-item">
            <label id="label-img">é•¿å›¾åˆ†äº«å®½åº¦</label>
            <select id="img-size"></select>
            <button class="btn btn-img" onclick="exportImage()" id="btn-img">å¯¼å‡ºé•¿å›¾</button>
        </div>
    </aside>

    <main class="content-area">
        <section class="pane">
            <header class="pane-head head-edit">
                <span id="head-editor">ç¼–è¾‘å™¨</span>
                <button class="clear-btn" onclick="clearContent()" id="btn-clear">æ¸…ç©º</button>
            </header>
            <div class="pane-body">
                <textarea id="input" oninput="update()" spellcheck="false"></textarea>
            </div>
        </section>
        <section class="pane">
            <header class="pane-head head-view">
                <span id="head-preview">é¢„è§ˆåŒº</span>
            </header>
            <div class="pane-body" id="preview-scroll">
                <div id="preview-inner"></div>
            </div>
        </section>
    </main>
</div>

<script>
    const inputEl = document.getElementById('input');
    const previewEl = document.getElementById('preview-inner');
    const pdfSelect = document.getElementById('pdf-size');
    const imgSelect = document.getElementById('img-size');

    const i18n = {
        zh: {
            pdfSize: "PDF å¯¼å‡ºå°ºå¯¸", exportPdf: "å¯¼å‡º PDF", imgSize: "é•¿å›¾åˆ†äº«å®½åº¦", exportImg: "å¯¼å‡ºé•¿å›¾",
            editor: "ç¼–è¾‘å™¨", preview: "é¢„è§ˆåŒº", clear: "æ¸…ç©ºå†…å®¹", custom: "è‡ªå®šä¹‰è§„æ ¼...", nextLang: "EN",
            pdfOptions: [{ val: "A4", text: "A4 æ ‡å‡† (210x297mm)" }, { val: "A3", text: "A3 å±•ç¤º (297x420mm)" }, { val: "A5", text: "A5 æ‰‹å†Œ (148x210mm)" }, { val: "Letter", text: "US Letter" }, { val: "custom", text: "è‡ªå®šä¹‰è§„æ ¼..." }],
            imgOptions: [{ group: "ç§»åŠ¨è®¾å¤‡", items: [{ val: "375", text: "æ‰‹æœºå®½åº¦ (375px)" }, { val: "414", text: "æ‰‹æœºå¤§å± (414px)" }, { val: "820", text: "å¹³æ¿å®½åº¦ (820px)" }]}, { group: "ç¤¾åª’åˆ†äº«", items: [{ val: "1080", text: "å¾®ä¿¡ / IG (1080px)" }, { val: "1242", text: "é«˜æ¸…é•¿å›¾ (1242px)" }, { val: "1500", text: "å¾®åš / å°çº¢ä¹¦ (1500px)" }]}],
            defaultText: "# MD2File ä½¿ç”¨æŒ‡å—\n\nè¿™æ˜¯ä¸€ä¸ªçº¯æœ¬åœ°è¿è¡Œçš„ Markdown è½¬æ¢å·¥å…·ã€‚æ‰€æœ‰æ“ä½œéƒ½åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­å®Œæˆã€‚\n\n### ğŸš€ æ ¸å¿ƒåŠŸèƒ½æç¤º\n\n1. **å¯¼å‡º PDF**ï¼šåœ¨è®¾ç½®é¢æ¿é€‰æ‹©é¢„è®¾å°ºå¯¸ï¼Œæ”¯æŒæ™ºèƒ½åˆ†é¡µé˜²æ­¢å†…å®¹æˆªæ–­ã€‚\n2. **å¯¼å‡ºé•¿å›¾**ï¼š3 å€é«˜æ¸…é‡‡æ ·ç®—æ³•ï¼Œç¡®ä¿æ–‡å­—åœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½æ¸…æ™°é”åˆ©ã€‚\n3. **å¸é¡¶å¯¼èˆª**ï¼šåœ¨ç§»åŠ¨ç«¯æ»‘åŠ¨æ—¶ï¼Œæ ‡é¢˜æ ä¼šé¡ºæ¬¡é”å®šåœ¨é¡¶éƒ¨ï¼Œæ°¸è¿œæ¸…æ™°å®šä½å½“å‰åŒºåŸŸã€‚\n4. **é»‘ç™½åè½¬**ï¼šç¼–è¾‘å™¨ä¸é¢„è§ˆåŒºé‡‡ç”¨é«˜å¯¹æ¯”åº¦åå‘è®¾è®¡ï¼Œä¾¿äºè§†è§‰åŒºåˆ†ã€‚\n5. **é˜…è¯»å¢å¼º**ï¼šå¯¼å‡ºé•¿å›¾è‡ªåŠ¨ä¼˜åŒ–å­—å·ä¸è¡Œé—´è·ï¼Œç¡®ä¿æ‰‹æœºå…¨å±é˜…è¯»ä¸è´¹åŠ›ã€‚\n6. **éšç§å®‰å…¨**ï¼š100% æµè§ˆå™¨æœ¬åœ°å¤„ç†ã€‚ä»£ç ä¸å«åç«¯ï¼Œæ‚¨çš„æ–‡æ¡£æ°¸ä¸ä¸Šä¼ ã€‚"
        },
        en: {
            pdfSize: "PDF SIZE", exportPdf: "EXPORT PDF", imgSize: "IMAGE WIDTH", exportImg: "EXPORT IMAGE",
            editor: "EDITOR", preview: "PREVIEW", clear: "CLEAR ALL", custom: "Custom...", nextLang: "ä¸­",
            pdfOptions: [{ val: "A4", text: "A4 Standard" }, { val: "A3", text: "A3 Display" }, { val: "A5", text: "A5 Booklet" }, { val: "Letter", text: "US Letter" }, { val: "custom", text: "Custom..." }],
            imgOptions: [{ group: "Mobile Simulation", items: [{ val: "375", text: "Standard (375px)" }, { val: "414", text: "Large (414px)" }, { val: "820", text: "Tablet (820px)" }]}, { group: "Social", items: [{ val: "1080", text: "Instagram (1080px)" }, { val: "1242", text: "High Res (1242px)" }, { val: "1500", text: "Social Feed (1500px)" }]}],
            defaultText: "# MD2File Guide\n\nA lightweight, local-first Markdown converter. All processing stays in your browser.\n\n### ğŸš€ Highlights\n\n1. **Export PDF**: Select presets in the control panel. Smart pagination prevents text clipping.\n2. **Export Image**: 3x HD sampling ensures every word is crisp on any device.\n3. **Sticky Headers**: Headers lock at the top on mobile for easy navigation.\n4. **Inverted Contrast**: Editor and Preview use inverted schemes for clear separation.\n5. **Readability Engine**: Auto-enlarges text and spacing for superior mobile reading.\n6. **Local Privacy**: 100% client-side. No data ever leaves your device."
        }
    };

    let currentLang = 'zh';

    function update() { previewEl.innerHTML = marked.parse(inputEl.value); }
    
    function toggleTheme() { 
        const isDark = document.body.getAttribute('data-theme') === 'dark';
        const newTheme = isDark ? 'light' : 'dark';
        
        // æ ¸å¿ƒä¿®å¤ï¼šåŒæ­¥ color-scheme
        document.documentElement.style.colorScheme = newTheme;
        document.body.setAttribute('data-theme', newTheme);
        document.documentElement.setAttribute('data-theme', newTheme);
        document.getElementById('theme-btn').innerText = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
        
        // æ ¸å¿ƒä¿®å¤ï¼šç¬é—´å¼ºåˆ¶æ›´æ–°ç³»ç»Ÿåº•è‰²ï¼Œæ— è§†ä»»ä½•è¿‡æ¸¡æ•ˆæœ
        const color = isDark ? '#f2f2f7' : '#000000';
        document.querySelectorAll('.dynamic-meta').forEach(m => m.setAttribute('content', color));
        document.documentElement.style.backgroundColor = color;
    }
    
    function toggleLang() { 
        const oldDefault = i18n[currentLang].defaultText;
        currentLang = currentLang === 'zh' ? 'en' : 'zh'; 
        renderUI(); 
        if (inputEl.value.trim() === "" || inputEl.value === oldDefault) {
            inputEl.value = i18n[currentLang].defaultText;
            update();
        }
    }
    
    function renderUI() {
        const lang = i18n[currentLang];
        pdfSelect.innerHTML = lang.pdfOptions.map(o => `<option value="${o.val}">${o.text}</option>`).join('');
        imgSelect.innerHTML = lang.imgOptions.map(g => `<optgroup label="${g.group}">${g.items.map(i => `<option value="${i.val}">${i.text}</option>`).join('')}</optgroup>`).join('');
        document.getElementById('label-pdf').innerText = lang.pdfSize;
        document.getElementById('btn-pdf').innerText = lang.exportPdf;
        document.getElementById('label-img').innerText = lang.imgSize;
        document.getElementById('btn-img').innerText = lang.exportImg;
        document.getElementById('head-editor').innerText = lang.editor;
        document.getElementById('head-preview').innerText = lang.preview;
        document.getElementById('btn-clear').innerText = lang.clear;
        document.getElementById('lang-btn').innerText = lang.nextLang;
    }
    
    async function exportPDF() {
        const sel = pdfSelect.value;
        const pdfS = { 'A4': [210, 297], 'A3': [297, 420], 'A5': [148, 210], 'Letter': [216, 279] };
        const w = sel === 'custom' ? document.getElementById('pw').value : pdfS[sel][0];
        const h = sel === 'custom' ? document.getElementById('ph').value : pdfS[sel][1];
        const opt = { margin: 12, filename: 'MD2File_Export.pdf', image: { type: 'jpeg', quality: 1 }, html2canvas: { scale: 3, useCORS: true, scrollY: 0 }, jsPDF: { unit: 'mm', format: [w, h], orientation: 'p' }, pagebreak: { mode: ['avoid-all', 'css'] } };
        html2pdf().set(opt).from(previewEl).save();
    }
    
    async function exportImage() {
        const w = imgSelect.value;
        const isDark = document.body.getAttribute('data-theme') === 'dark';
        const exportBgColor = isDark ? '#1c1c1e' : '#ffffff'; 
        const clone = previewEl.cloneNode(true);
        clone.classList.add('clone-hidden');
        clone.classList.add('export-mode'); 
        clone.style.width = w + 'px';
        clone.style.background = exportBgColor; 
        clone.style.color = isDark ? '#f5f5f7' : '#1d1d1f';
        document.body.appendChild(clone);
        await new Promise(r => setTimeout(r, 600));
        const canvas = await html2canvas(clone, { scale: 3, useCORS: true, backgroundColor: exportBgColor });
        const link = document.createElement('a');
        link.download = 'MD2File_Image.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        document.body.removeChild(clone);
    }
    
    function clearContent() { if(confirm("Clear content?")) { inputEl.value = ""; update(); } }
    function checkCustom() { document.getElementById('custom-pdf').style.display = pdfSelect.value === 'custom' ? 'flex' : 'none'; }
    renderUI();
    inputEl.value = i18n.zh.defaultText;
    update();
</script>
</body>
</html>
