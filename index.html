<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MD2File</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <style>
        :root {
            --bg: #f8f9fa;
            --sidebar-bg: #ffffff;
            --pane-bg: #ffffff;
            --text: #1a1a1a;
            --text-sec: #666;
            --border: rgba(0, 0, 0, 0.08);
            --btn-main: #1a1a1a;
            --btn-main-text: #ffffff;
            --accent: #007aff;
        }

        [data-theme="dark"] {
            --bg: #121212;
            --sidebar-bg: #1e1e1e;
            --pane-bg: #252525;
            --text: #e0e0e0;
            --text-sec: #aaa;
            --border: rgba(255, 255, 255, 0.1);
            --btn-main: #f0f0f0;
            --btn-main-text: #1a1a1a;
        }

        body {
            margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--bg); color: var(--text);
            transition: background 0.3s, color 0.3s;
            overflow-x: hidden;
        }

        /* Â∏ÉÂ±Ä */
        .app-container { display: flex; height: 100vh; width: 100vw; overflow: hidden; }

        .sidebar {
            width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border);
            padding: 24px; display: flex; flex-direction: column; gap: 18px; flex-shrink: 0;
            box-sizing: border-box; overflow-y: auto; z-index: 10;
        }

        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .brand { font-size: 1.5rem; font-weight: 800; letter-spacing: -1px; }
        .top-tools { display: flex; gap: 8px; }
        .icon-btn { 
            background: none; border: 1px solid var(--border); border-radius: 6px; 
            cursor: pointer; padding: 6px 10px; color: var(--text); font-size: 12px;
            transition: all 0.2s;
        }
        .icon-btn:hover { background: rgba(0,0,0,0.05); }

        .control-item { display: flex; flex-direction: column; gap: 6px; }
        label { font-size: 11px; font-weight: 700; color: var(--text-sec); text-transform: uppercase; letter-spacing: 0.5px; }

        select, input {
            padding: 10px; border: 1px solid var(--border); border-radius: 8px;
            font-size: 14px; outline: none; background: var(--pane-bg); color: var(--text);
            appearance: none; -webkit-appearance: none;
        }

        .btn {
            padding: 12px; border: none; border-radius: 8px; cursor: pointer;
            font-weight: 600; font-size: 14px; transition: 0.2s;
        }
        .btn-pdf { background: var(--btn-main); color: var(--btn-main-text); }
        .btn-img { background: transparent; border: 1px solid var(--btn-main); color: var(--text); }
        .btn:active { transform: scale(0.98); opacity: 0.8; }

        .content-area { flex: 1; display: flex; padding: 15px; gap: 15px; box-sizing: border-box; }
        .pane {
            flex: 1; display: flex; flex-direction: column; background: var(--pane-bg);
            border-radius: 12px; border: 1px solid var(--border); overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
        }
        .pane-head {
            padding: 10px 16px; background: rgba(0,0,0,0.02); border-bottom: 1px solid var(--border);
            font-size: 10px; font-weight: 700; color: var(--text-sec); letter-spacing: 1px;
        }

        textarea {
            flex: 1; padding: 20px; border: none; resize: none; outline: none;
            font-family: 'Fira Code', 'Cascadia Code', monospace; font-size: 14px; line-height: 1.6;
            background: transparent; color: var(--text);
        }

        #preview { flex: 1; padding: 35px; overflow-y: auto; background: var(--pane-bg); line-height: 1.7; color: var(--text); }

        /* --- ÊâãÊú∫Á´ØÈÄÇÈÖçÈÄªËæë --- */
        @media (max-width: 850px) {
            .app-container { flex-direction: column; height: auto; overflow: visible; }
            .sidebar { 
                width: 100%; border-right: none; border-bottom: 1px solid var(--border); 
                padding: 15px; position: sticky; top: 0;
                box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            }
            .content-area { flex-direction: column; height: auto; padding: 10px; overflow: visible; }
            .pane { flex: none; height: 70vh; min-height: 500px; margin-bottom: 10px; }
            textarea, #preview { font-size: 16px; } /* Ëß£ÂÜ≥ iOS ÁÑ¶ÁÇπÊîæÂ§ßÈóÆÈ¢ò */
        }

        /* Ê∏≤ÊüìÊ†∑ÂºèÂÆöÂà∂ */
        #preview h1 { border-bottom: 2px solid var(--border); padding-bottom: 10px; margin-top: 0; }
        #preview code { background: rgba(0,0,0,0.05); padding: 2px 4px; border-radius: 4px; font-family: monospace; }
        [data-theme="dark"] #preview code { background: rgba(255,255,255,0.1); }
        #preview blockquote { border-left: 4px solid var(--border); margin: 1.5em 0; padding-left: 1em; color: var(--text-sec); font-style: italic; }
        #preview img { max-width: 100%; border-radius: 8px; }
        .clone-hidden { position: absolute; left: -9999px; top: 0; height: auto !important; }
    </style>
</head>
<body>

<div class="app-container">
    <aside class="sidebar">
        <div class="header-row">
            <div class="brand">MD2File</div>
            <div class="top-tools">
                <button class="icon-btn" onclick="toggleLang()" id="lang-btn">EN</button>
                <button class="icon-btn" onclick="toggleTheme()" id="theme-btn">üåô</button>
            </div>
        </div>
        
        <div class="control-item">
            <label id="label-pdf-size">PDF Â∞∫ÂØ∏</label>
            <select id="pdf-size" onchange="checkCustom()"></select>
            <div id="custom-pdf" style="display:none; gap:5px; margin-top:5px;">
                <input type="number" id="pw" placeholder="ÂÆΩmm" value="210">
                <input type="number" id="ph" placeholder="È´òmm" value="297">
            </div>
            <button class="btn btn-pdf" onclick="exportPDF()" id="btn-pdf">ÂØºÂá∫ PDF</button>
        </div>

        <hr style="border: 0; border-top: 1px solid var(--border); margin: 5px 0;">

        <div class="control-item">
            <label id="label-img-size">ÂõæÁâá / Á§æÂ™íÂ∞∫ÂØ∏</label>
            <select id="img-size"></select>
            <button class="btn btn-img" onclick="exportImage()" id="btn-img">ÂØºÂá∫ÈïøÂõæ</button>
        </div>
    </aside>

    <main class="content-area">
        <div class="pane">
            <div class="pane-head" id="head-editor">ÁºñËæëÂô®</div>
            <textarea id="input" oninput="update()" spellcheck="false"></textarea>
        </div>
        <div class="pane">
            <div class="pane-head" id="head-preview">È¢ÑËßàÂå∫</div>
            <div id="preview"></div>
        </div>
    </main>
</div>

<script>
    const inputEl = document.getElementById('input');
    const previewEl = document.getElementById('preview');
    const pdfSelect = document.getElementById('pdf-size');
    const imgSelect = document.getElementById('img-size');

    // ÂÆåÊï¥ÁöÑ i18n ÈÖçÁΩÆ‰∏éÂäüËÉΩÂÖ®ÊèêÁ§∫
    const i18n = {
        zh: {
            pdfSize: "PDF Â∞∫ÂØ∏", exportPdf: "ÂØºÂá∫ PDF",
            imgSize: "ÂõæÁâá / Á§æÂ™íÂ∞∫ÂØ∏", exportImg: "ÂØºÂá∫ÈïøÂõæ",
            editor: "ÁºñËæëÂô®", preview: "È¢ÑËßàÂå∫", custom: "Ëá™ÂÆö‰πâ...",
            pdfOptions: [
                { val: "A4", text: "A4 ÊâìÂç∞Á∫∏ (210x297mm)" },
                { val: "A5", text: "A5 ÊâãÂÜå (148x210mm)" },
                { val: "Letter", text: "‰ø°Á∫∏ (216x279mm)" },
                { val: "custom", text: "Ëá™ÂÆö‰πâÂ∞∫ÂØ∏..." }
            ],
            imgOptions: [
                { group: "ÊâãÊú∫ËÆæÂ§áÂÆΩÂ∫¶", items: [
                    { val: "360", text: "Ê†áÂáÜÊâãÊú∫ (360px)" },
                    { val: "412", text: "Â§ßÂ±èÊâãÊú∫ (412px)" },
                    { val: "820", text: "Âπ≥Êùø (820px)" }
                ]},
                { group: "Á§æ‰∫§Â™í‰ΩìÂ∏∏Áî®ÂÆΩÂ∫¶", items: [
                    { val: "1080", text: "Instagram / ÂæÆ‰ø° (1080px)" },
                    { val: "1200", text: "X / Twitter (1200px)" },
                    { val: "1500", text: "ÂæÆÂçö / Â∞èÁ∫¢‰π¶ (1500px)" }
                ]}
            ],
            defaultText: "# MD2File ‰ΩøÁî®ÊåáÂçó\n\nËøôÊòØ‰∏Ä‰∏™Á∫ØÊú¨Âú∞ËøêË°åÁöÑ Markdown ËΩ¨Êç¢Â∑•ÂÖ∑„ÄÇÊâÄÊúâÊìç‰ΩúÈÉΩÂú®ÊÇ®ÁöÑÊµèËßàÂô®‰∏≠ÂÆåÊàê„ÄÇ\n\n### üöÄ Ê†∏ÂøÉÂäüËÉΩÊèêÁ§∫\n1. **ÂØºÂá∫ PDF**ÔºöÈÄâÊã© A4 ÊàñËá™ÂÆö‰πâÂ∞∫ÂØ∏ÔºåÈÄÇÂêàÊâìÂç∞ÂíåÊ≠£ÂºèÊñáÊ°£„ÄÇ\n2. **ÂØºÂá∫ÈïøÂõæ**ÔºöÈÄâÊã©ÊâãÊú∫ÊàñÁ§æÂ™íÂÆΩÂ∫¶Ôºå‰∏ÄÈîÆÁîüÊàêÈÄÇÂêàÂàÜ‰∫´ÁöÑÈ´òÊ∏ÖÈ¢ÑËßàÂõæ„ÄÇ\n3. **‰∏ªÈ¢òÂàáÊç¢**ÔºöÁÇπÂáªÂè≥‰∏äËßí üåô ÊåâÈíÆÂºÄÂêØÊöóËâ≤Ê®°ÂºèÔºå‰øùÊä§ËßÜÂäõ„ÄÇ\n4. **Â§öËØ≠Ë®Ä**ÔºöÁÇπÂáªÈ°∂ÈÉ® EN ÊåâÈíÆÂèØÂàáÊç¢ÂÖ®ÁïåÈù¢ËØ≠Ë®Ä„ÄÇ\n5. **Êô∫ËÉΩÂëΩÂêç**ÔºöÂ∑•ÂÖ∑‰ºöËá™Âä®Â∞Ü‰Ω†ÁöÑ**Á¨¨‰∏ÄË°åÊñáÂ≠ó**‰Ωú‰∏∫ÂØºÂá∫ÁöÑÊñá‰ª∂Âêç„ÄÇ\n\n> ËØïÁùÄ‰øÆÊîπÁºñËæëÂô®ÂÜÖÁöÑÂÜÖÂÆπÔºåÈ¢ÑËßàÂå∫‰ºöÂÆûÊó∂ÊòæÁ§∫È¢ÑËßàÊïàÊûú„ÄÇ"
        },
        en: {
            pdfSize: "PDF SIZE", exportPdf: "Export PDF",
            imgSize: "IMAGE / SOCIAL SIZE", exportImg: "Export Image",
            editor: "EDITOR", preview: "PREVIEW", custom: "Custom...",
            pdfOptions: [
                { val: "A4", text: "A4 Paper (210x297mm)" },
                { val: "A5", text: "A5 Leaflet (148x210mm)" },
                { val: "Letter", text: "US Letter (216x279mm)" },
                { val: "custom", text: "Custom Size..." }
            ],
            imgOptions: [
                { group: "Phone Widths", items: [
                    { val: "360", text: "Standard Mobile (360px)" },
                    { val: "412", text: "Large Mobile (412px)" },
                    { val: "820", text: "Tablet (820px)" }
                ]},
                { group: "Social Media Widths", items: [
                    { val: "1080", text: "Instagram / WeChat (1080px)" },
                    { val: "1200", text: "X / Twitter (1200px)" },
                    { val: "1500", text: "Weibo / Red (1500px)" }
                ]}
            ],
            defaultText: "# MD2File Guide\n\nA lightweight, local-first Markdown converter. All processing stays in your browser.\n\n### üöÄ Quick Tips\n1. **Export PDF**: Choose A4 or custom mm in the sidebar, perfect for printing.\n2. **Export Image**: Select mobile or social media widths for high-quality sharing.\n3. **Appearance**: Click the üåô icon at the top to toggle Dark Mode.\n4. **Language**: Click the '‰∏≠Êñá' button to switch the entire interface language.\n5. **Smart Naming**: The **first line** of your text will be used as the filename.\n\n> Try editing the text on the left to see the live preview on the right."
        }
    };

    let currentLang = 'zh';

    function update() { previewEl.innerHTML = marked.parse(inputEl.value); }

    function toggleTheme() {
        const body = document.body;
        const isDark = body.getAttribute('data-theme') === 'dark';
        body.setAttribute('data-theme', isDark ? 'light' : 'dark');
        document.getElementById('theme-btn').innerText = isDark ? 'üåô' : '‚òÄÔ∏è';
    }

    function renderSelects() {
        const lang = i18n[currentLang];
        pdfSelect.innerHTML = lang.pdfOptions.map(o => `<option value="${o.val}">${o.text}</option>`).join('');
        imgSelect.innerHTML = lang.imgOptions.map(g => `<optgroup label="${g.group}">${g.items.map(i => `<option value="${i.val}">${i.text}</option>`).join('')}</optgroup>`).join('');
    }

    function toggleLang() {
        const oldDefault = i18n[currentLang].defaultText;
        currentLang = currentLang === 'zh' ? 'en' : 'zh';
        const lang = i18n[currentLang];
        
        document.getElementById('lang-btn').innerText = currentLang === 'zh' ? 'EN' : '‰∏≠Êñá';
        document.getElementById('label-pdf-size').innerText = lang.pdfSize;
        document.getElementById('btn-pdf').innerText = lang.exportPdf;
        document.getElementById('label-img-size').innerText = lang.imgSize;
        document.getElementById('btn-img').innerText = lang.exportImg;
        document.getElementById('head-editor').innerText = lang.editor;
        document.getElementById('head-preview').innerText = lang.preview;
        
        renderSelects();
        
        // Êô∫ËÉΩÂêåÊ≠•ÂÜÖÂÆπ
        if (inputEl.value.trim() === "" || inputEl.value === oldDefault) {
            inputEl.value = lang.defaultText;
            update();
        }
    }

    function checkCustom() { document.getElementById('custom-pdf').style.display = pdfSelect.value === 'custom' ? 'flex' : 'none'; }

    function getName(ext, res) {
        const lines = inputEl.value.split('\n');
        const first = lines.find(l => l.trim()) || 'Untitled';
        const name = first.replace(/[#*`>]/g, '').trim().substring(0, 20).replace(/[/\\?%*:|"<>]/g, '');
        return `${name}_${res}.${ext}`;
    }

    async function exportPDF() {
        const pdfSizes = { 'A4': [210, 297], 'A5': [148, 210], 'Letter': [216, 279] };
        const sel = pdfSelect.value;
        const w = sel === 'custom' ? document.getElementById('pw').value : pdfSizes[sel][0];
        const h = sel === 'custom' ? document.getElementById('ph').value : pdfSizes[sel][1];
        
        const btn = document.getElementById('btn-pdf');
        btn.innerText = "...";

        const opt = {
            margin: 10, filename: getName('pdf', `${w}x${h}mm`),
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true, backgroundColor: '#ffffff' },
            jsPDF: { unit: 'mm', format: [w, h], orientation: w > h ? 'l' : 'p' }
        };
        
        try {
            await html2pdf().set(opt).from(previewEl).save();
        } finally {
            btn.innerText = i18n[currentLang].exportPdf;
        }
    }

    async function exportImage() {
        const w = imgSelect.value;
        const btn = document.getElementById('btn-img');
        btn.innerText = "...";
        
        const currentBg = getComputedStyle(document.documentElement).getPropertyValue('--pane-bg');
        const clone = previewEl.cloneNode(true);
        clone.classList.add('clone-hidden');
        clone.style.width = w + 'px';
        clone.style.background = currentBg;
        document.body.appendChild(clone);

        await new Promise(r => setTimeout(r, 400));
        try {
            const canvas = await html2canvas(clone, { scale: 2, useCORS: true, backgroundColor: currentBg.trim() });
            const link = document.createElement('a');
            link.download = getName('png', `${w}px`);
            link.href = canvas.toDataURL();
            link.click();
        } finally {
            document.body.removeChild(clone);
            btn.innerText = i18n[currentLang].exportImg;
        }
    }

    // ÂàùÂßãÂåñ
    renderSelects();
    inputEl.value = i18n.zh.defaultText;
    update();
</script>
</body>
</html>
